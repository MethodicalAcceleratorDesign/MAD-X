q1: quadrupole, l=1, k1=1.2;
q2: quadrupole, l=1, k1=-1.3;

ss: sequence,l=1;
q1,at=0.5;
q2,at=1.5;
endsequence;

!beam,pc=0.000001;
beam,pc=100;
use,sequence=ss;

pt0=0.1;
deltas=sqrt(pt0^2 + 2*pt0/beam->beta+1)-1;
x0=1e-3; y0=1e-3;
px0=1e-3; py0=1e-3;
p0c=beam->pc;
psc=p0c*(1+deltas);
es=sqrt(beam->mass**2 + psc**2);


twiss,betx=1,bety=1,x=x0, y=y0, px=px0, py=py0;
qx1=table(twiss,ss$end,mux);qy1=table(twiss,ss$end,muy);
betx1=table(twiss,ss$end,betx); bety1=table(twiss,ss$end,bety);
x1=table(twiss,ss$end,x);
y1=table(twiss,ss$end,y);
xp1=table(twiss,ss$end,px);
yp1=table(twiss,ss$end,py);
print,text="trackend";

q1,ktap=deltas;
q2,ktap=deltas;

twiss,betx=1/(1+deltas),bety=1/(1+deltas),pt=pt0,x=x0, y=y0, px=px0*(1+deltas), py=py0*(1+deltas);
qx2=table(twiss,ss$end,mux);qy2=table(twiss,ss$end,muy);
betx2=table(twiss,ss$end,betx)/(1+deltas); bety2=table(twiss,ss$end,bety)/(1+deltas);
x2=table(twiss,ss$end,x);
y2=table(twiss,ss$end,y);
xp2=table(twiss,ss$end,px)/(1+deltas);
yp2=table(twiss,ss$end,py)/(1+deltas);
print,text="trackend";

twiss,betx=1/(1+deltas),bety=1/(1+deltas),pt=pt0,x=x0, y=y0, px=px0*(1+deltas), py=py0*(1+deltas),exact;
qx3=table(twiss,ss$end,mux);qy3=table(twiss,ss$end,muy);
betx3=table(twiss,ss$end,betx)/(1+deltas); bety3=table(twiss,ss$end,bety)/(1+deltas);
x3=table(twiss,ss$end,x);
y3=table(twiss,ss$end,y);
xp3=table(twiss,ss$end,px)/(1+deltas);
yp3=table(twiss,ss$end,py)/(1+deltas);

value,deltas;
value,qx1,qx2,qx3;
value,qy1,qy2,qy3;
value,betx1,betx2,betx3;
value,bety1,bety2,bety3;
value,x1,x2,x3;
value,y1,y2,y3;
value,xp1,xp2,xp3;
value,yp1,yp2,yp3;
value,beam->beta;
